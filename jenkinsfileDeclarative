pipeline
{
agent any 

tools {
maven 'maven3.6.3'
}
triggers{
pollSCM('* * * * *')
}
options{
 timestamps()
 buildDiscarder(logRotator(artifactDaysToKeepStr: '', artifactNumToKeepStr: '4', daysToKeepStr: '', numToKeepStr: '4'))
}


stages{
stage('checkout code')

{
steps{
git branch: 'development', credentialsId: '5654c5a3-a413-4e36-81c2-f640ec6cde16', url: 'https://github.com/santhosh911/maven-web-application.git'
}
}

stage('build')
{

steps{
sh "mvn clean package"
}
}
stage('ExecuteSonarqube report')
{
steps{
sh "mvn sonar:sonar"
}
}

stage('UploadArtifactsintoNexus')
{
steps{
sh "mvn deploy"
}
}
stage('DeployappintoTomcat')
{
steps{
sshagent(['02416f48-fb5f-4b09-b061-f8c719b38974']) {
    sh "rm -rf /opt/apache-tomcat-9.0.46/webapps/maven-web-application.war"
   sh "scp -o StrictHostKeyChecking=no target/maven-web-application.war ec2-user@13.127.221.169:/opt/apache-tomcat-9.0.46/webapps/"
}
}
}
}


post
{

success{
emailext body: '''Buids is ocver Declaraative way

Regards
santhosh''', subject: 'Build is over -Declarative way', to: 'santhosh.sunday@gmail.com,santhosh.sunday@yahoo.com'
}

failure{
emailext body: '''Buils is failure Declaraative way

Regards
santhosh''', subject: 'Build is over -Declarative way', to: 'santhosh.sunday@gmail.com,santhosh.sunday@yahoo.com'
}

}
}
